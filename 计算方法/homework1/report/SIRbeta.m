clear
% true data
xx = linspace(0,72,73)';
ss = [4944;4964;4986;5027;5066;5080;5094;5135;
    5182;5233;5293;5400;5729;6087;6452;6714;
    7158;7591;7862;8177;8506;9334;10351;11366;
    12283;13281;14471;17044;20244;23838;27078;29498;
    32582;35077;37712;39642;42379;43780;46252;47913;
    49519;50811;56300;57550;58339;59068;59342;59605;
    59868;60113;60366;60583;60907;61141;61370;61514;
    61741;61936;62104;62174;62251;62348;62431;62521;
    62605;62658;62714;62772;62816;62865;62911;62950;
    62982;62988];

cc = [4281;4307;4428;4472;4612;4635;4716;4779;
    4800;4833;4870;4898;4943;4972;4998;5037;
    5068;5098;5125;5166;5213;5270;5389;5616;
    5914;6305;6646;7387;7936;8911;9288;10021;
    11238;12923;14100;15836;17715;19958;22409;24352;
    26992;29302;31782;34593;37649;41891;45873;47742;
    49481;50871;52535;53476;54121;54968;55575;56008;
    56424;57146;57439;57497;57812;58087;58354;58539;
    58798;59142;59379;59759;60027;60371;60499;60661;
    60775;60879];

I = ss(1:end) - cc(1:end);

dI = I(2:end) - I(1:end-1);
dR = cc(2:end) - cc(1:end-1);

i = I(1:end-1);

gamma = dR ./ i;
beta = (dR + dI) ./ i;

figure(1);
plot(xx, beta, '*'); hold on;
title("beta(t)"); xlabel t; ylabel beta(t);
figure(2);
plot(xx, gamma, '*'); hold on;
title("gamma(t)"); xlabel t; ylabel gamma(t);

syms b(t) g(t)

b = fit(xx, beta,'exp1');
g = fit(xx, gamma, 'exp1');
figure(1); plot(b(xx));
figure(2); plot(g(xx));

f=@(t,y)[y(1)*(b(t)-g(t));g(t)*y(1)];
[x,y]=ode45(f,1:xx(end),[i(1) cc(1)]);

figure(3);
plot(xx, I(1:end-1),'*');
hold on;plot(x,y(:,1));
title("I(t)"); xlabel t; ylabel I(t);
legend('真实确诊人数', "I(t)数值模拟结果");
figure(4);
plot(xx, cc(1:end-1),'*');
hold on;plot(x,y(:,2));
title("R(t)"); xlabel t; ylabel R(t);
legend('真实确诊人数', "R(t)数值模拟结果");


